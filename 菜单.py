import math

# ===================== Общие функции =====================
def f1(x):
    return x**3 - 12*x - 8

def f1_производная(x):
    return 3*x**2 - 12

def f2(x):
    return x**3 + 4*x - 6

def f2_производная(x):
    return 3*x**2 + 4

# ===================== Метод 1: Метод Ньютона =====================
def метод_ньютона(f, df, x0, eps=1e-6, max_итераций=1000):
    x = x0
    for i in range(max_итераций):
        fx = f(x)
        if abs(fx) < eps:
            return x, i+1
        dfx = df(x)
        if dfx == 0:
            raise ValueError("Производная равна нулю, метод Ньютона не работает")
        x = x - fx / dfx
    raise ValueError("Метод Ньютона не сошелся за максимальное число итераций")

# ===================== Метод 2: Метод дихотомии =====================
def метод_дихотомии(f, a, b, eps=1e-6, max_итераций=1000):
    if f(a) * f(b) > 0:
        raise ValueError("На концах отрезка значения функции одного знака")
    
    for i in range(max_итераций):
        c = (a + b) / 2
        if f(c) == 0 or (b - a) / 2 < eps:
            return c, i+1
        if f(a) * f(c) < 0:
            b = c
        else:
            a = c
    raise ValueError("Метод дихотомии не сошелся за максимальное число итераций")

# ===================== Метод 3: Метод хорд =====================
def метод_хорд(f, x0, x1, eps=1e-6, max_итераций=1000):
    for i in range(max_итераций):
        f0 = f(x0)
        f1 = f(x1)
        if f1 - f0 == 0:
            raise ValueError("Деление на ноль в методе хорд")
        x2 = x1 - f1 * (x1 - x0) / (f1 - f0)
        if abs(x2 - x1) < eps:
            return x2, i+1
        x0, x1 = x1, x2
    raise ValueError("Метод хорд не сошелся за максимальное число итераций")

# ===================== Главное меню =====================
def главное_меню():
    print("========================================")
    print("  Пакет программ: Численные методы")
    print("========================================")
    print("1. Метод Ньютона (касательных)")
    print("2. Метод Дихотомии (бисекции)")
    print("3. Метод Хорд (секущих)")
    print("4. Выход")
    print("========================================")
    выбор = input("Выберите метод (1-4): ")
    return выбор

# ===================== Выбор уравнения =====================
def выбрать_уравнение():
    print("\nВыберите уравнение:")
    print("1. x^3 - 12x - 8 = 0")
    print("2. x^3 + 4x - 6 = 0")
    выбор_уравнения = input("Введите номер уравнения (1 или 2): ")
    if выбор_уравнения == '1':
        return f1, f1_производная, "x^3 - 12x - 8 = 0", (-1, 1)
    elif выбор_уравнения == '2':
        return f2, f2_производная, "x^3 + 4x - 6 = 0", (-0.1, 1.2)
    else:
        print("Неверный выбор, используется уравнение 1.")
        return f1, f1_производная, "x^3 - 12x - 8 = 0", (-1, 1)

# ===================== Основная программа =====================
if __name__ == "__main__":
    while True:
        выбор = главное_меню()
        
        if выбор == '4':
            print("Выход из программы.")
            break
        
        if выбор not in ['1', '2', '3']:
            print("Неверный выбор, попробуйте снова.")
            continue
        
        f, df, уравнение, интервал = выбрать_уравнение()
        a, b = интервал
        
        print(f"\nУравнение: {уравнение}")
        print(f"Интервал: [{a}, {b}]")
        print(f"Точность: 1e-6\n")
        
        if выбор == '1':  # Метод Ньютона
            print("Метод Ньютона (касательных):")
            try:
                x_a, итерации_a = метод_ньютона(f, df, a)
                print(f"Начальное приближение a={a}: корень = {x_a:.10f}, итераций = {итерации_a}")
            except Exception as e:
                print(f"Ошибка для a={a}: {e}")
            try:
                x_b, итерации_b = метод_ньютона(f, df, b)
                print(f"Начальное приближение b={b}: корень = {x_b:.10f}, итераций = {итерации_b}")
            except Exception as e:
                print(f"Ошибка для b={b}: {e}")
                
        elif выбор == '2':  # Метод дихотомии
            print("Метод Дихотомии:")
            try:
                корень, итерации = метод_дихотомии(f, a, b)
                print(f"Корень = {корень:.10f}, итераций = {итерации}")
            except Exception as e:
                print(f"Ошибка: {e}")
                
        elif выбор == '3':  # Метод хорд
            print("Метод Хорд:")
            try:
                корень, итерации = метод_хорд(f, a, b)
                print(f"Корень = {корень:.10f}, итераций = {итерации}")
            except Exception as e:
                print(f"Ошибка: {e}")
        
        print("\n" + "="*40 + "\n")
